<!DOCTYPE html>
<html>

	<head>
		<title></title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link href="css/mui.min.css" rel="stylesheet"/>
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
		<link rel="stylesheet" type="text/css" href="css/iconfont.css"/>
		<style type="text/css">
			u {
				font-size: 16px;
			}
			.mui-input-group {
				margin-top: 10px;
			}
			.avatar-list {
				width: 100%;
				display: flex;
				flex-wrap: wrap;
  				align-items: center;
  				justify-content: space-between;
			}
			.avatar-item {
				box-sizing: border-box;
				padding: 15px;
				width: 30%;
				position: relative;
				
			}
			.avatar-item img {
				width: 100%;
			}
			.avatar-item .mui-icon {
				display: none;
				position: absolute;
				top: 0px;
				right: 0px;
				color: #086BD3;
				font-size: 28px;
				font-weight: bolder;
			}
			.avatar-item:hover .mui-icon {
				display: block;
			}
		</style>
	</head>

	<body>
			<header class="mui-bar mui-bar-nav">
			    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			    <h1 class="mui-title" id="title"></h1>
			    <a class="mui-icon mui-pull-right" id="commit"><u>提交</u></a>
			</header>
		<div class="mui-content" id="body">
			
		</div>

		<script src="js/mui.min.js"></script>
		<script src="js/public.js" type="text/javascript" charset="utf-8"></script>
		<script>
			mui.plusReady(function () {
			    var self = plus.webview.currentWebview();
			    var param = self.key;
			    var body = document.getElementById("body");
			    var title = document.getElementById("title");
			    switch (param){
			    	case "pwd":
			    		title.innerHTML = "修改密码";
			    		body.innerHTML = '<div class="mui-input-group">'+
										    '<div class="mui-input-row">'+
										        '<label>当前密码</label>'+
										        '<input id="pwd-now" type="password" class="mui-input-clear">'+
										    '</div>'+
										   	'<div class="mui-input-row">'+
										        '<label>新密码</label>'+
										        '<input id="pwd-new" type="password" class="mui-input-clear">'+
										   	'</div>'+
										    '<div class="mui-input-row">'+
										        '<label>确认密码</label>'+
										        '<input id="pwd-confirm" type="password" class="mui-input-clear">'+
										    '</div>'+
										'</div>';
			    		break;
			    	case "username":
			    		title.innerHTML = "修改昵称";
			    		body.innerHTML = '<div class="mui-input-group">'+
										    '<div class="mui-input-row">'+
												'<label>昵称</label>'+
												'<input id="nickName" maxlength="12" type="text" class="mui-input-clear">'+
											'</div>'+
										'</div>';
			    		break;
		    		case "avatar":
		    			title.innerHTML = "选择头像";
		    			body.innerHTML = '<div class="mui-card">'+
											'<div class="mui-card-header">男</div>'+
											'<div class="mui-card-content">'+
												'<div class="mui-card-content-inner">'+
													'<ul class="avatar-list">'+
														'<li class="avatar-item"><img src="img/avatar/m_01.png" data-id="m_01" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/m_02.png" data-id="m_02"/><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/m_03.png" data-id="m_03" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/m_04.png" data-id="m_04" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/m_05.png" data-id="m_05" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/m_06.png" data-id="m_06" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/m_07.png" data-id="m_07" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/m_08.png" data-id="m_08" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/m_09.png" data-id="m_09" /><span class="mui-icon iconfont icon-selected"></span></li>'+
													'</ul>'+
												'</div>'+
											'</div>'+
										'</div>'+
										'<div class="mui-card">'+
											'<div class="mui-card-header">女</div>'+
											'<div class="mui-card-content">'+
												'<div class="mui-card-content-inner">'+
													'<ul class="avatar-list">'+
														'<li class="avatar-item"><img src="img/avatar/w_01.png" data-id="w_01" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/w_02.png" data-id="w_02"/><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/w_03.png" data-id="w_03" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/w_04.png" data-id="w_04" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/w_05.png" data-id="w_05" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/w_06.png" data-id="w_06" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/w_07.png" data-id="w_07" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/w_08.png" data-id="w_08" /><span class="mui-icon iconfont icon-selected"></span></li>'+
														'<li class="avatar-item"><img src="img/avatar/w_09.png" data-id="w_09" /><span class="mui-icon iconfont icon-selected"></span></li>'+
													'</ul>'+
												'</div>'+
											'</div>'+
										'</div>';
						var headIcon = "";
						body.addEventListener('tap', function(e){
							var _target = e.target;
							if(_target.tagName.toLocaleLowerCase() == "li") {
								_target = _target.getElementsByTagName("img")[0];
							} else if (_target.tagName.toLocaleLowerCase() == "img") {
								_target = _target;
							} else {
								return;
							}
							headIcon = _target.dataset.id
						})
						
		    			break;
			    }
			    
			    document.getElementById("commit").addEventListener('tap', function() {
			    	var _data = {
			    		userId: localStorage.getItem("userId")
			    	};
			    	switch (param){
			    		case "pwd":
			    		
			    			var nowPwd = document.getElementById("pwd-now").value;
			    			var newPwd = document.getElementById("pwd-new").value;
			    			var conPwd = document.getElementById("pwd-confirm").value;
			    			
			    			if(!(nowPwd && newPwd && conPwd)){
			    				mui.alert("信息填写完整");
			    				return;
			    			}else{
			    				if(newPwd != conPwd){
			    					mui.alert("两次密码不一致");
			    					return;
			    				}
			    			}
			    			
			    			_data.password = newPwd;
			    		
			    		
			    			break;
			    		case "username":
			    		
			    			var nickName = document.getElementById("nickName").value;
			    			if(!nickName){
			    				return;
			    			}else{
			    				_data.nickName = nickName;
								localStorage.setItem("nickName",nickName);
			    				
			    			}
			    		
			    		
			    			break;
			    		case "avatar":
			    			if(headIcon){
			    				_data.headIcon = headIcon;
			    				localStorage.setItem("headIcon", headIcon);
			    			}else{
			    				return;
			    			}
			    			break;
			    	}
			    	
			    	commit(_data);
			    })
			    
			    
			    
			    function commit(_data) {
					
			    	muiPost(api.userUpdate, _data, function(data) {
			    		console.log(data.errorMsg);
			    		if(data.errorCode != 0) {
			    			mui.alert("更新失败..");
			    			return;
			    		}
						plus.webview.getWebviewById('account-info.html').reload();
						setTimeout(function(){
							mui.back();
						},100);
			    	})
			    	
			    }
			    
			    
			})
		</script>
	</body>

</html>